<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>UniversalFile Playground - Experience Spatial Documents</title>
    <style>
        :root {
            --bg: #0a0a0a;
            --fg: #00ff00;
            --accent: #ff00ff;
            --grid: #1a1a1a;
        }
        
        body {
            background: var(--bg);
            color: var(--fg);
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            background-image: 
                repeating-linear-gradient(0deg, var(--grid) 0, transparent 1px, transparent 40px, var(--grid) 40px),
                repeating-linear-gradient(90deg, var(--grid) 0, transparent 1px, transparent 40px, var(--grid) 40px);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .panel {
            background: rgba(0,0,0,0.8);
            border: 2px solid var(--fg);
            padding: 20px;
            border-radius: 4px;
            box-shadow: 0 0 20px rgba(0,255,0,0.3);
        }
        
        h1 {
            text-align: center;
            color: var(--accent);
            text-shadow: 0 0 10px var(--accent);
            margin-bottom: 40px;
        }
        
        .code-editor {
            width: 100%;
            min-height: 300px;
            background: #000;
            color: var(--fg);
            border: 1px solid var(--fg);
            padding: 10px;
            font-family: inherit;
            resize: vertical;
        }
        
        .spatial-view {
            height: 400px;
            border: 1px solid var(--fg);
            position: relative;
            overflow: hidden;
            background: radial-gradient(circle at center, transparent 0%, var(--bg) 100%);
        }
        
        .item-node {
            position: absolute;
            padding: 5px 10px;
            background: var(--bg);
            border: 1px solid var(--fg);
            cursor: move;
            transition: all 0.3s;
            font-size: 12px;
        }
        
        .item-node:hover {
            border-color: var(--accent);
            box-shadow: 0 0 10px var(--accent);
            z-index: 10;
        }
        
        .bagua-indicator {
            display: inline-block;
            margin-left: 5px;
            font-size: 16px;
        }
        
        button {
            background: var(--bg);
            color: var(--fg);
            border: 2px solid var(--fg);
            padding: 10px 20px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.3s;
            margin: 5px;
        }
        
        button:hover {
            background: var(--fg);
            color: var(--bg);
            box-shadow: 0 0 10px var(--fg);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .stat-box {
            border: 1px solid var(--fg);
            padding: 10px;
            text-align: center;
        }
        
        .drop-zone {
            border: 2px dashed var(--fg);
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s;
        }
        
        .drop-zone.dragover {
            border-color: var(--accent);
            background: rgba(255,0,255,0.1);
        }
    </style>
</head>
<body>
    <h1>üåå UniversalFile Playground</h1>
    
    <div class="container">
        <div class="panel">
            <h2>üìù Code Editor</h2>
            <textarea class="code-editor" id="codeEditor">
// Create your spatial document
const doc = new UniversalDocument();

// Add a note in space
doc.addItem({
    type: UniversalDocument.ItemType.NOTIZZETTEL,
    title: "Hello Universe!",
    position: { x: 200, y: 150, z: 0 },
    content: { text: "My first spatial thought" },
    bagua_descriptor: UniversalDocument.BAGUA.KUN | UniversalDocument.BAGUA.XUN
});

// Add a system item
doc.addItem({
    type: UniversalDocument.ItemType.SYSTEM,
    title: "Control Center",
    position: { x: 400, y: 200, z: 1 },
    content: { status: "active" },
    bagua_descriptor: UniversalDocument.BAGUA.TAIJI
});

return doc;</textarea>
            
            <div style="margin-top: 10px;">
                <button onclick="runCode()">‚ñ∂ Run Code</button>
                <button onclick="saveAsUD()">üíæ Save as .ud</button>
                <button onclick="clearAll()">üóëÔ∏è Clear</button>
            </div>
            
            <div class="drop-zone" id="dropZone">
                Drop .ud files here to load
            </div>
        </div>
        
        <div class="panel">
            <h2>üó∫Ô∏è Spatial View</h2>
            <div class="spatial-view" id="spatialView"></div>
            
            <div class="stats" id="stats">
                <div class="stat-box">
                    <strong>Items</strong>
                    <div id="itemCount">0</div>
                </div>
                <div class="stat-box">
                    <strong>Binary Size</strong>
                    <div id="binarySize">0 KB</div>
                </div>
                <div class="stat-box">
                    <strong>Format</strong>
                    <div>v2.0</div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="panel" style="grid-column: 1 / -1; margin-top: 20px;">
        <h2>üîç Binary Inspector</h2>
        <pre id="hexDump" style="font-size: 12px; overflow-x: auto;"></pre>
    </div>

    <script type="module">
        import { UniversalDocument } from './universalDocument.js';
        
        window.UniversalDocument = UniversalDocument;
        let currentDoc = null;
        
        window.runCode = function() {
            try {
                const code = document.getElementById('codeEditor').value;
                const func = new Function('UniversalDocument', code);
                currentDoc = func(UniversalDocument);
                updateView();
            } catch (error) {
                alert('Error: ' + error.message);
            }
        };
        
        window.saveAsUD = function() {
            if (!currentDoc) return;
            
            const binary = currentDoc.toBinary();
            const blob = new Blob([binary], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'playground-' + Date.now() + '.ud';
            a.click();
        };
        
        window.clearAll = function() {
            currentDoc = new UniversalDocument();
            updateView();
        };
        
        function updateView() {
            if (!currentDoc) return;
            
            // Update spatial view
            const spatialView = document.getElementById('spatialView');
            spatialView.innerHTML = '';
            
            currentDoc.allItems.forEach(item => {
                const node = document.createElement('div');
                node.className = 'item-node';
                node.style.left = (item.position.x / 4) + 'px';
                node.style.top = (item.position.y / 4) + 'px';
                node.innerHTML = `
                    ${item.title}
                    <span class="bagua-indicator">${getBaguaSymbols(item.bagua_descriptor)}</span>
                `;
                spatialView.appendChild(node);
            });
            
            // Update stats
            document.getElementById('itemCount').textContent = currentDoc.allItems.length;
            const binary = currentDoc.toBinary();
            document.getElementById('binarySize').textContent = (binary.byteLength / 1024).toFixed(2) + ' KB';
            
            // Update hex dump
            updateHexDump(binary);
        }
        
        function getBaguaSymbols(descriptor) {
            let symbols = '';
            for (const [name, value] of Object.entries(UniversalDocument.BAGUA)) {
                if (descriptor & value) {
                    const info = UniversalDocument.BAGUA_NAMES.get(value);
                    if (info) symbols += info.symbol;
                }
            }
            return symbols;
        }
        
        function updateHexDump(buffer) {
            const bytes = new Uint8Array(buffer);
            const hexDump = document.getElementById('hexDump');
            let html = '';
            
            for (let i = 0; i < Math.min(bytes.length, 256); i += 16) {
                const hex = Array.from(bytes.slice(i, i + 16))
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join(' ');
                const ascii = Array.from(bytes.slice(i, i + 16))
                    .map(b => b >= 32 && b <= 126 ? String.fromCharCode(b) : '.')
                    .join('');
                html += `${i.toString(16).padStart(8, '0')}  ${hex.padEnd(48, ' ')}  |${ascii}|\n`;
            }
            
            if (bytes.length > 256) {
                html += '\n... (truncated)';
            }
            
            hexDump.textContent = html;
        }
        
        // Drag & Drop
        const dropZone = document.getElementById('dropZone');
        
        dropZone.addEventListener('dragover', (e)

